<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥–æ–≤–æ –ê–¥–º–∏–Ω–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'JetBrains Mono', monospace; }
        body { background: linear-gradient(to bottom, #000000, #00ff00c9); color: #00ff00; min-height: 100vh; transition: background 0.3s ease; }
        .supabase-login-section { padding: 20px; text-align: center; background: rgba(0, 0, 0, 0.7); margin-bottom: 20px; display: none; }
        .supabase-login-section button { background: #00c200; color: #000; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; font-family: 'JetBrains Mono', monospace; font-weight: bold; }
        .login-section { padding: 20px; text-align: center; background: rgba(0, 0, 0, 0.7); margin-bottom: 20px; }
        .login-form { display: inline-block; background: rgba(0, 255, 0, 0.1); padding: 20px; border-radius: 10px; border: 1px solid #00ff00; }
        .login-form input { background: #008800; color: #00ff00; border: 1px solid #00ff00; padding: 10px; margin: 5px; border-radius: 5px; font-family: 'JetBrains Mono', monospace; }
        .login-form button { background: #00c200; color: #000; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; cursor: pointer; font-family: 'JetBrains Mono', monospace; font-weight: bold; }
        .login-form button:hover { background: #00f000; }
        .error-message { color: #ff0000; margin-top: 10px; display: none; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .section { background: rgba(0, 0, 0, 0.8); border: 1px solid #00ff00; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .section h2 { color: #00ff00; margin-bottom: 15px; text-align: center; border-bottom: 1px solid #00ff00; padding-bottom: 10px; }
        .buttons-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-top: 15px; }
        .btn { background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 12px 8px; border-radius: 5px; cursor: pointer; text-align: center; transition: all 0.3s ease; font-family: 'JetBrains Mono', monospace; }
        .btn:hover { background: #00ff00; color: #000; }
        .status-message { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0, 255, 0, 0.9); color: #000; padding: 15px 30px; border-radius: 5px; font-weight: bold; z-index: 1000; display: none; }
        .error-bg { background: linear-gradient(to bottom, #000000, #ff0000) !important; }
        .playlist { max-height: 400px; overflow-y: auto; border: 1px solid #00ff00; border-radius: 5px; padding: 10px; background: rgba(0, 0, 0, 0.5); }
        .track-item { padding: 10px; margin: 5px 0; background: rgba(0, 255, 0, 0.1); border-radius: 5px; cursor: pointer; transition: background 0.3s ease; }
        .track-item:hover { background: rgba(0, 255, 0, 0.3); }
        .music-controls { margin-top: 15px; text-align: center; }
        .music-controls button { background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 8px 15px; margin: 0 5px; border-radius: 5px; cursor: pointer; font-family: 'JetBrains Mono', monospace; }
        .music-controls button:hover { background: #00ff00; color: #000; }
        .now-playing { margin-top: 10px; text-align: center; font-style: italic; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th { background: rgba(0, 255, 0, 0.2); color: #00ff00; padding: 10px; text-align: left; border: 1px solid #00ff00; }
        .data-table td { padding: 8px 10px; border: 1px solid rgba(0, 255, 0, 0.3); color: #8fd493; }
        .data-table tr:hover { background: rgba(0, 255, 0, 0.1); }
        .action-btn { background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 5px 10px; margin: 2px; border-radius: 3px; cursor: pointer; font-size: 0.8em; }
        .action-btn:hover { background: #00ff00; color: #000; }
        .action-btn.delete { color: #ff4444; border-color: #ff4444; }
        .action-btn.delete:hover { background: #ff4444; color: #000; }
        .action-btn.warning { color: #ffc107; border-color: #ffc107; }
        .action-btn.warning:hover { background: #ffc107; color: #000; }
        .search-box { width: 100%; padding: 10px; background: #008800; color: #00ff00; border: 1px solid #00ff00; border-radius: 5px; margin-bottom: 15px; }
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .pagination button { background: #000; color: #00ff00; border: 1px solid #00ff00; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        .pagination button.active { background: #00ff00; color: #000; }
        .loading { text-align: center; padding: 20px; color: #8fd493; }
        .user-info { position: absolute; top: 20px; right: 20px; color: #8fd493; font-size: 0.9em; }
        .logout-btn { background: rgba(255, 68, 68, 0.2); color: #ff4444; border: 1px solid rgba(255, 68, 68, 0.3); padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-left: 10px; font-size: 0.8em; }
        .invite-section { margin-bottom: 20px; padding: 15px; background: rgba(0, 255, 0, 0.1); border: 1px solid #00ff00; border-radius: 10px; }
        .invite-form { display: flex; gap: 10px; margin-top: 10px; }
        .invite-form input { flex: 1; padding: 10px; background: #008800; color: #00ff00; border: 1px solid #00ff00; border-radius: 5px; }
        .invite-form button { background: #00c200; color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .invite-form button:disabled { background: #666; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="status-message" id="statusMessage">–†–∞–±–æ—Ç–∞–µ—Ç!</div>
    <div class="user-info" id="userInfo" style="display: none;"><span id="userEmail"></span><button onclick="logoutSupabase()" class="logout-btn">–í—ã–π—Ç–∏</button></div>
    <div class="supabase-login-section" id="supabaseLoginSection"><h3>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3><button onclick="window.location.href='login.html'">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Supabase</button></div>
    <div class="login-section" id="adminLoginSection">
        <div class="login-form">
            <h3>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" value="Admin">
            <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <button onclick="checkLogin()">–í–æ–π—Ç–∏</button>
            <div class="error-message" id="errorMessage">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!</div>
        </div>
    </div>
    <div class="container" id="content" style="display: none;">
        <div class="section">
            <h2>üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–∞–º–∏ Supabase</h2>
            <div class="invite-section">
                <h3>üì® –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                <p style="color: #8fd493; margin-bottom: 10px;">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ email. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç —Å—Å—ã–ª–∫—É –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.</p>
                <div class="invite-form"><input type="email" id="inviteEmail" placeholder="email@example.com"><button onclick="inviteUser()" id="inviteButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button></div>
                <div id="inviteStatus" style="margin-top: 10px; display: none;"></div>
            </div>
            <div style="margin-bottom: 30px;"><h3>üìÖ –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (bookings)</h3><input type="text" class="search-box" id="searchBookings" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, email –∏–ª–∏ ID..." onkeyup="searchBookings()"><div id="bookingsTable"></div><div class="pagination" id="bookingsPagination"></div></div>
            <div><h3>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3><input type="text" class="search-box" id="searchUsers" placeholder="–ü–æ–∏—Å–∫ –ø–æ email –∏–ª–∏ username..." onkeyup="searchUsers()"><div id="usersTable"></div><div class="pagination" id="usersPagination"></div></div>
        </div>
        <div class="section">
            <h2>Sounds</h2>
            <div class="buttons-grid">
                <button class="btn" onclick="playSound('err_snds/HTML200.mp3')">HTML200</button>
                <button class="btn" onclick="playSound('err_snds/HTML401.mp3')">HTML401</button>
                <button class="btn" onclick="playSound('err_snds/HTML403.mp3')">HTML403</button>
                <button class="btn" onclick="playSound('err_snds/HTML404.mp3')">HTML404</button>
                <button class="btn" onclick="playSound('err_snds/HTML420.mp3')">HTML420</button>
                <button class="btn" onclick="playSound('err_snds/HTML451.mp3')">HTML451</button>
                <button class="btn" onclick="playSound('err_snds/HTML500.mp3')">HTML500</button>
                <button class="btn" onclick="playSound('err_snds/HTML502.mp3')">HTML502</button>
                <button class="btn" onclick="playSound('sounds/boil.mp3')">boil</button>
                <button class="btn" onclick="playSound('sounds/quantum.mp3')">quantum</button>
                <button class="btn" onclick="playSound('sounds/success.mp3')">success</button>
            </div>
        </div>
        <div class="section">
            <h2>Pages</h2>
            <div class="buttons-grid">
                <button class="btn" onclick="checkPage('401.html')">401.html</button>
                <button class="btn" onclick="checkPage('403.html')">403.html</button>
                <button class="btn" onclick="checkPage('404.html')">404.html</button>
                <button class="btn" onclick="checkPage('420.html')">420.html</button>
                <button class="btn" onclick="checkPage('451.html')">451.html</button>
                <button class="btn" onclick="checkPage('500.html')">500.html</button>
                <button class="btn" onclick="checkPage('booking.html')">booking.html</button>
                <button class="btn" onclick="checkPage('index.html')">index.html</button>
                <button class="btn" onclick="checkPage('leaderboard.html')">leaderboard.html</button>
                <button class="btn" onclick="checkPage('login.html')">login.html</button>
                <button class="btn" onclick="checkPage('music-player.html')">music-player.html</button>
                <button class="btn" onclick="checkPage('price-list.html')">price-list.html</button>
                <button class="btn" onclick="checkPage('register.html')">register.html</button>
                <button class="btn" onclick="checkPage('rules.html')">rules.html</button>
                <button class="btn" onclick="checkPage('tea.html')">tea.html</button>
                <button class="btn" onclick="checkPage('upd-form.html')">upd-form.html</button>
            </div>
        </div>
        <div class="section">
            <h2>Quick Links</h2>
            <div class="buttons-grid">
                <button class="btn" onclick="window.location.href='booking.html'">Booking</button>
                <button class="btn" onclick="window.location.href='psswrd-chngr.html'">Password Changer</button>
            </div>
        </div>
        <div class="section">
            <h2>Background</h2>
            <div class="buttons-grid">
                <button class="btn" onclick="checkBackground('background/background1.jpg')">background1.jpg</button>
                <button class="btn" onclick="checkBackground('background/background2.jpg')">background2.jpg</button>
                <button class="btn" onclick="checkBackground('background/background3.jpg')">background3.jpg</button>
                <button class="btn" onclick="checkBackground('background/background4.jpg')">background4.jpg</button>
                <button class="btn" onclick="checkBackground('background/background5.jpg')">background5.jpg</button>
                <button class="btn" onclick="checkBackground('background/background6.jpg')">background6.jpg</button>
                <button class="btn" onclick="checkBackground('background/background7.jpg')">background7.jpg</button>
                <button class="btn" onclick="checkBackground('background/background8.jpg')">background8.jpg</button>
                <button class="btn" onclick="checkBackground('background/background9.jpg')">background9.jpg</button>
                <button class="btn" onclick="checkBackground('background/background10.jpg')">background10.jpg</button>
                <button class="btn" onclick="checkBackground('background/background11.jpg')">background11.jpg</button>
            </div>
        </div>
        <div class="section">
            <h2>Others</h2>
            <div class="buttons-grid">
                <button class="btn" onclick="checkPage('code.txt')">code.txt check</button>
                <button class="btn" onclick="checkPage('favicon.ico')">favicon.ico check</button>
                <button class="btn" onclick="checkPage('logo.jpeg')">logo.jpeg check</button>
                <button class="btn" onclick="checkPage('style.css')">style.css check</button>
            </div>
        </div>
        <div class="section">
            <h2>Music</h2>
            <div class="playlist">
                <div class="track-item" data-track="music/8BitEra-SuperMario.mp3" data-name="8BitEra - Super Mario">–¢–µ–º–∞ –∏–∑ –∏–≥—Ä—ã Super Mario</div>
                <div class="track-item" data-track="music/Aleksandr_Rybak-Fairytale.mp3" data-name="–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –†—ã–±–∞–∫ - Fairytale">Fairytale (–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –†—ã–±–∞–∫)</div>
                <div class="track-item" data-track="music/APSENT-Mojno_ya_s_toboy.mp3" data-name="AP$ENT - –ú–æ–∂–Ω–æ —è —Å —Ç–æ–±–æ–π">–ú–æ–∂–Ω–æ —è —Å —Ç–æ–±–æ–π (AP$ENT)</div>
                <div class="track-item" data-track="music/BassCover-Hoist_the_Colours.mp3" data-name="BassCover - Hoist the Colours">Hoist the Colours (BassCover, Hans Zimmer)</div>
                <div class="track-item" data-track="music/C418-Area_Math.mp3" data-name="C418 - Area Math">Area Math (C418, Minecraft)</div>
                <div class="track-item" data-track="music/C418-Wet_Hands.mp3" data-name="C418 - Wet Hands">Wet Hands (C418, Minecraft)</div>
                <div class="track-item" data-track="music/Dyan_Dxxdy-Cute_Depressed.mp3" data-name="Dyan Dxxdy - Cute Depressed">Cute Depressed (Dyan Dxxdy)</div>
                <div class="track-item" data-track="music/Dyan_Dxxdy-Cute_Depressed_Slowed.mp3" data-name="Dyan Dxxdy - Cute Depressed (Slowed)">Cute Depressed (Slowed) (Dyan Dxxdy)</div>
                <div class="track-item" data-track="music/Imagine_Dragons-Believer.mp3" data-name="Imagine Dragons - Believer">Believer (Imagine Dragons)</div>
                <div class="track-item" data-track="music/Imagine_Dragons-Bones.mp3" data-name="Imagine Dragons - Bones">Bones (Imagine Dragons)</div>
                <div class="track-item" data-track="music/Imagine_Dragons-Natural.mp3" data-name="Imagine Dragons - Natural">Natural (Imagine Dragons)</div>
                <div class="track-item" data-track="music/Imagine_Dragons-Thunder.mp3" data-name="Imagine Dragons - Thunder">Thunder (Imagine Dragons)</div>
                <div class="track-item" data-track="music/Korol_i_Shut-Eli_Myaso_Muzhiki.mp3" data-name="–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç - –ï–ª–∏ –º—è—Å–æ –º—É–∂–∏–∫–∏">–ï–ª–∏ –º—è—Å–æ –º—É–∂–∏–∫–∏ (–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç)</div>
                <div class="track-item" data-track="music/Korol_i_Shut-Kukla_Kolduna.mp3" data-name="–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç - –ö—É–∫–ª–∞ –∫–æ–ª–¥—É–Ω–∞">–ö—É–∫–ª–∞ –∫–æ–ª–¥—É–Ω–∞ (–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç)</div>
                <div class="track-item" data-track="music/Korol_i_Shut-Prygnu_so_Skaly.mp3" data-name="–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç - –ü—Ä—ã–≥–Ω—É —Å–æ —Å–∫–∞–ª—ã">–ü—Ä—ã–≥–Ω—É —Å–æ —Å–∫–∞–ª—ã (–ö–æ—Ä–æ–ª—å –∏ –®—É—Ç)</div>
                <div class="track-item" data-track="music/Lubeh-Horse.mp3" data-name="–õ—é–±—ç - –ö–æ–Ω—å">–ö–æ–Ω—å (–õ—é–±—ç)</div>
                <div class="track-item" data-track="music/Mission_Impossible-Main_Theme.mp3" data-name="Mission Impossible (Main Theme)">Main theme from Mission Impossible</div>
                <div class="track-item" data-track="music/NFSUG-Doomsday.mp3" data-name="Need For Speed Underground: Doomsday">Doomsday (Need For Speed Underground</div>
                <div class="track-item" data-track="music/ReLogic-Alternate_Day.mp3" data-name="Re-Logic - Alternate Day">Alternate Day (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Dungeon.mp3" data-name="Re-Logic - Dungeon">Dungeon (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Eclipse.mp3" data-name="Re-Logic - Eclipse">Eclipse (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Ice.mp3" data-name="Re-Logic - Ice">Ice (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Mushrooms.mp3" data-name="Re-Logic - Mushrooms">Mushrooms (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Ocean.mp3" data-name="Re-Logic - Ocean">Ocean (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Overworld_Day.mp3" data-name="Re-Logic - Overworld Day">Overworld Day (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Overworld_Night.mp3" data-name="Re-Logic - Overworld Night">Overworld Night (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/ReLogic-Title_Screen.mp3" data-name="Re-Logic - Title Screen">Title Screen (Re-Logic, Terraria)</div>
                <div class="track-item" data-track="music/Sheet_Music_Boss-RUSH_E.mp3" data-name="Sheet Music Boss - RUSH E">RUSH E (Sheet Music Boss)</div>
                <div class="track-item" data-track="music/Star_Wars-The_Imperial_March.mp3" data-name="Star Wars - The Imperial March">The Imperial March (Star Wars)</div>
                <div class="track-item" data-track="music/WW-OIIA_Cat.mp3" data-name="W&W - OIIA Cat">OIIA Cat (W&W)</div>
            </div>
            <div class="music-controls">
                <button onclick="playMusic()">‚ñ∂Ô∏è –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏</button>
                <button onclick="pauseMusic()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                <button onclick="stopMusic()">‚èπÔ∏è –°—Ç–æ–ø</button>
            </div>
            <div class="now-playing" id="nowPlaying"></div>
        </div>
    </div>

    <script>
        // ==================== –ö–û–ù–§–ò–ì ====================
        const SUPABASE_URL = 'https://gdbemyluqtnfytvujfnu.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdkYmVteWx1cXRuZnl0dnVqZm51Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU3ODIwMDAsImV4cCI6MjA4MTM1ODAwMH0.tpEicR_8Bt2R_CIn_kpAZlcXcX8o9CIWXt7mtnAuejg';
        const EMAILJS_PUBLIC_KEY = 'qsXC8gCcga_7pNr1w';
        const EMAILJS_SERVICE_ID = 'LVR_Inviter';
        const EMAILJS_TEMPLATE_ID = 'template_odnburo';
        
        let supabase = null;
        let currentUser = null;
        let isAdmin = false;
        let isLocalAdmin = false;
        const passwordHashes = [
            "2db556f27d28be05fc9745c5513f57fc47e59a8eeda5339a6c3b5bce5258b03e",
            "ea613b6918aef7b32e7a875e649c92309eb3a6e0cae10289dc721d74ad2613a5",
            "590ab3a941c688f46e6aba6826f60aa7357d744ad41c2c801264cdc0a3a15806",
            "238146fd103e82c4ff2072c8038193432fc09f376b02642f9eadefa2d5a8203c"
        ];
        let currentBookingsPage = 1;
        let currentUsersPage = 1;
        const itemsPerPage = 10;
        let audio = null;
        let currentTrack = null;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {auth: {autoRefreshToken: true, persistSession: true, detectSessionInUrl: true, storage: localStorage}});
            if (typeof emailjs !== 'undefined') {emailjs.init(EMAILJS_PUBLIC_KEY); console.log('‚úÖ EmailJS –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');}
            await checkSupabaseAuth();
            document.querySelectorAll('.track-item').forEach(item => {item.addEventListener('click', function() {const track = this.getAttribute('data-track'); const name = this.getAttribute('data-name'); playTrack(track, name);});});
        });

        // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
        async function checkSupabaseAuth() {
            try {
                console.log('üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) {console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–µ—Å—Å–∏–∏:', error); showLocalAdminLogin(); return;}
                if (session && session.user) {currentUser = session.user; console.log('‚úÖ Supabase –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUser.email); await checkIfAdmin();} 
                else {console.log('‚ùå Supabase: –ù–µ—Ç —Å–µ—Å—Å–∏–∏'); showLocalAdminLogin();}
            } catch (error) {console.error('‚ùå –û—à–∏–±–∫–∞ Supabase –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error); showLocalAdminLogin();}
        }

        async function checkIfAdmin() {
            try {
                const { data: profile, error } = await supabase.from('profiles').select('user_type, username').eq('id', currentUser.id).single();
                if (error) {
                    console.log('–ü—Ä–æ—Ñ–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–µ–º...');
                    const { error: createError } = await supabase.from('profiles').insert({id: currentUser.id, email: currentUser.email, username: currentUser.email.split('@')[0] || 'user', user_type: 'admin', created_at: new Date().toISOString()});
                    if (createError) {console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', createError); showLocalAdminLogin(); return;}
                    isAdmin = true; showAdminInterface(); return;
                }
                if (profile && profile.user_type === 'admin') {isAdmin = true; showAdminInterface();} 
                else {show403Error();}
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω-–ø—Ä–∞–≤:', error); showLocalAdminLogin();}
        }

        function showLocalAdminLogin() {
            console.log('üë®‚Äçüíº –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –∞–¥–º–∏–Ω–∫—É');
            document.getElementById('supabaseLoginSection').style.display = 'none';
            document.getElementById('adminLoginSection').style.display = 'block';
            document.getElementById('content').style.display = 'none';
            document.getElementById('userInfo').style.display = 'none';
        }

        function show403Error() {
            console.log('üö´ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω - 403');
            setTimeout(() => {window.location.href = '403.html';}, 1500);
            document.body.innerHTML = '<div style="text-align: center; padding: 100px; color: #ff4444;"><h1 style="font-size: 3em;">403</h1><h2>–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2><p>–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</p><p style="color: #8fd493; margin-top: 20px;">–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É 403...</p></div>';
        }

        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function checkLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const content = document.getElementById('content');
            if (username === 'Admin') {
                const passwordHash = await sha256(password);
                if (passwordHashes.includes(passwordHash)) {
                    isLocalAdmin = true;
                    content.style.display = 'block';
                    errorMessage.style.display = 'none';
                    document.getElementById('adminLoginSection').style.display = 'none';
                    showStatus('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                    loadBookingsTable();
                    loadUsersTable();
                    return;
                }
            }
            errorMessage.style.display = 'block';
            document.body.classList.add('error-bg');
            setTimeout(() => {document.body.classList.remove('error-bg');}, 1000);
        }

        function showAdminInterface() {
            console.log('üõ†Ô∏è –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å');
            document.getElementById('supabaseLoginSection').style.display = 'none';
            document.getElementById('adminLoginSection').style.display = 'none';
            document.getElementById('content').style.display = 'block';
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('userEmail').textContent = currentUser.email;
            loadBookingsTable();
            loadUsersTable();
        }

        // ==================== EMAILJS –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ï ====================
        async function inviteUser() {
            const emailInput = document.getElementById('inviteEmail');
            const inviteButton = document.getElementById('inviteButton');
            const inviteStatus = document.getElementById('inviteStatus');
            const email = emailInput.value.trim();
            if (!email || !email.includes('@')) {showStatus('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email', true); return;}
            if (!confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ ' + email + '?\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏—Ç –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ —Ö–∞–∫–µ—Ä—Å–∫–æ–º —Å—Ç–∏–ª–µ.')) return;
            inviteButton.disabled = true;
            inviteButton.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            inviteStatus.style.display = 'block';
            inviteStatus.style.color = '#8fd493';
            inviteStatus.innerHTML = 'üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞...';
            try {
                const userLogin = email.split('@')[0] || 'user';
                const userPassword = generateTemporaryPassword();
                const messageId = 'LOGOVO-' + Date.now() + '-' + Math.random().toString(36).substr(2, 6).toUpperCase();
                const { data: supabaseData, error: supabaseError } = await supabase.auth.signUp({email: email, password: userPassword, options: {emailRedirectTo: 'https://timon4ikru.github.io/LogovoVR/login.html', data: {is_invited: true, invited_at: new Date().toISOString(), invited_by: currentUser ? currentUser.id : 'local_admin'}}});
                if (supabaseError && !supabaseError.message.includes('already registered')) {throw new Error('Supabase: ' + supabaseError.message);}
                if (supabaseData && supabaseData.user) {
                    await supabase.from('profiles').upsert({id: supabaseData.user.id, email: email, username: userLogin, user_type: 'user', invited_by: currentUser ? currentUser.id : 'local_admin', created_at: new Date().toISOString()});
                }
                const templateParams = {to_email: email, to_name: userLogin, email: email, login: userLogin, password: userPassword, website_url: 'https://timon4ikru.github.io/LogovoVR', login_url: 'https://timon4ikru.github.io/LogovoVR/login.html', current_year: new Date().getFullYear(), timestamp: new Date().toLocaleString('ru-RU', {year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit'}), message_id: messageId};
                if (typeof emailjs === 'undefined') {throw new Error('EmailJS –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞.');}
                const emailResult = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
                console.log('EmailJS —Ä–µ–∑—É–ª—å—Ç–∞—Ç:', emailResult);
                showStatus('‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ ' + email);
                inviteStatus.style.color = '#00ff00';
                inviteStatus.innerHTML = '‚úÖ <strong>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!</strong><br>' +
                    'üìß Email: ' + email + '<br>' +
                    'üë§ –õ–æ–≥–∏–Ω: ' + userLogin + '<br>' +
                    'üîë –ü–∞—Ä–æ–ª—å: <span style="color:#ff4444">' + userPassword + '</span><br>' +
                    'üìù –°–æ–æ–±—â–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!';
                emailInput.value = '';
                loadUsersTable(currentUsersPage);
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:', error);
                let errorMessage = '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ';
                if (error.message.includes('already registered')) {
                    errorMessage = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. ';
                    try {
                        const userLogin = email.split('@')[0] || 'user';
                        const userPassword = generateTemporaryPassword();
                        const templateParams = {to_email: email, to_name: userLogin, email: email, login: userLogin, password: userPassword, website_url: 'https://timon4ikru.github.io/LogovoVR', login_url: 'https://timon4ikru.github.io/LogovoVR/login.html', current_year: new Date().getFullYear(), timestamp: new Date().toLocaleString('ru-RU'), message_id: 'LOGOVO-' + Date.now()};
                        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);
                        inviteStatus.style.color = '#ffc107';
                        inviteStatus.innerHTML = '‚ö†Ô∏è <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç</strong><br>' +
                            'üìß –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–∞ ' + email + '<br>' +
                            'üë§ –õ–æ–≥–∏–Ω: ' + userLogin + '<br>' +
                            'üîë –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å: <span style="color:#ff4444">' + userPassword + '</span><br>' +
                            'üí° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å!';
                        showStatus('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ');
                        emailInput.value = '';
                        return;
                    } catch (emailError) {errorMessage += '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ.';}
                } else if (error.message.includes('EmailJS')) {errorMessage += '–ü—Ä–æ–±–ª–µ–º–∞ —Å EmailJS. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏.';} 
                else {errorMessage += error.message;}
                showStatus(errorMessage, true);
                inviteStatus.style.color = '#ff4444';
                inviteStatus.innerHTML = '‚ùå ' + errorMessage;
            } finally {
                inviteButton.disabled = false;
                inviteButton.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ';
            }
        }

        function generateTemporaryPassword() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let password = '';
            for (let i = 0; i < 10; i++) {password += chars.charAt(Math.floor(Math.random() * chars.length));}
            return password + '!';
        }

        // ==================== –ê–î–ú–ò–ù–°–ö–ò–ï –û–ü–ï–†–ê–¶–ò–ò ====================
        async function sendPasswordReset(userId, userEmail) {
            if (!confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –Ω–∞ ' + userEmail + '?')) return;
            try {
                const { error } = await supabase.auth.resetPasswordForEmail(userEmail, {redirectTo: 'https://timon4ikru.github.io/LogovoVR/reset-password.html'});
                if (error) throw error;
                showStatus('–°—Å—ã–ª–∫–∞ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ ' + userEmail);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Å—ã–ª–∫–∏:', error); showStatus('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å—Å—ã–ª–∫–∏', true);}
        }

        async function makeAdmin(userId, userEmail) {
            if (!confirm('–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ' + userEmail + ' –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º?')) return;
            try {
                const { error } = await supabase.from('profiles').update({ user_type: 'admin' }).eq('id', userId);
                if (error) throw error;
                showStatus('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ' + userEmail + ' –Ω–∞–∑–Ω–∞—á–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º');
                loadUsersTable(currentUsersPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞:', error); showStatus('–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞', true);}
        }

        async function makeUser(userId, userEmail) {
            if (!confirm('–°–¥–µ–ª–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ' + userEmail + ' –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º?')) return;
            try {
                const { error } = await supabase.from('profiles').update({ user_type: 'user' }).eq('id', userId);
                if (error) throw error;
                showStatus('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ' + userEmail + ' —Å—Ç–∞–ª –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º');
                loadUsersTable(currentUsersPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞:', error); showStatus('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞', true);}
        }

        async function changeUsername(userId, userEmail) {
            const newUsername = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π username –¥–ª—è ' + userEmail + ':', 'user');
            if (!newUsername || newUsername.trim().length < 2) {alert('Username –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤'); return;}
            try {
                const { error } = await supabase.from('profiles').update({ username: newUsername.trim() }).eq('id', userId);
                if (error) throw error;
                showStatus('Username –¥–ª—è ' + userEmail + ' –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "' + newUsername + '"');
                loadUsersTable(currentUsersPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã username:', error); showStatus('–û—à–∏–±–∫–∞ —Å–º–µ–Ω—ã username', true);}
        }

        async function deleteProfile(userId, userEmail) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å ' + userEmail + '?\n\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã profiles. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ.')) return;
            try {
                const { error } = await supabase.from('profiles').delete().eq('id', userId);
                if (error) throw error;
                showStatus('–ü—Ä–æ—Ñ–∏–ª—å ' + userEmail + ' —É–¥–∞–ª–µ–Ω');
                loadUsersTable(currentUsersPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è:', error); showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è', true);}
        }

        // ==================== –ë–†–û–ù–ò–†–û–í–ê–ù–ò–Ø ====================
        async function loadBookingsTable(page = 1, search = '') {
            try {
                document.getElementById('bookingsTable').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π...</div>';
                let query = supabase.from('bookings').select('*', { count: 'exact' });
                if (search) {query = query.or('phone.ilike.%' + search + '%,user_email.ilike.%' + search + '%,id.eq.' + (parseInt(search) || 0));}
                const { data: bookings, error, count } = await query.order('created_at', { ascending: false }).range((page - 1) * itemsPerPage, page * itemsPerPage - 1);
                if (error) {console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:', error); document.getElementById('bookingsTable').innerHTML = '<div style="color: #ff4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>'; return;}
                currentBookingsPage = page;
                displayBookingsTable(bookings || []);
                createPagination('bookingsPagination', count || 0, page, 'loadBookingsTable');
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:', error); document.getElementById('bookingsTable').innerHTML = '<div style="color: #ff4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>';}
        }
        
        function displayBookingsTable(bookings) {
            if (!bookings || bookings.length === 0) {
                document.getElementById('bookingsTable').innerHTML = '<div style="color: #666; text-align: center;">–ù–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>';
                return;
            }
            
            let html = '<table class="data-table"><thead><tr><th>ID</th><th>–î–∞—Ç–∞</th><th>–í—Ä–µ–º—è</th><th>–õ—é–¥–µ–π</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th><th>–°—Ç–∞—Ç—É—Å</th><th>–°–æ–∑–¥–∞–Ω–æ</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
            
            bookings.forEach(booking => {
                let dateStr = booking.date || booking.formatted_date || '–ù–µ—Ç –¥–∞—Ç—ã';
                let userEmail = booking.user_email || booking.email || '–ù–µ—Ç email';
                let createdStr = booking.created_at ? new Date(booking.created_at).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                const statusColors = {'pending': '#ffc107', 'confirmed': '#00ff00', 'cancelled': '#ff4444'};
                const statusTexts = {'pending': '–û–∂–∏–¥–∞–Ω–∏–µ', 'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ', 'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–æ'};
                const status = booking.status || 'pending';
                
                html += '<tr>' +
                    '<td>' + (booking.id || 'N/A') + '</td>' +
                    '<td>' + dateStr + '</td>' +
                    '<td>' + (booking.hours || '–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–∏') + '</td>' +
                    '<td>' + (booking.people || 1) + '</td>' +
                    '<td>' + (booking.phone || '–ù–µ—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞') + '</td>' +
                    '<td>' + userEmail + '</td>' +
                    '<td style="color: ' + (statusColors[status] || '#fff') + '">' + (statusTexts[status] || status) + '</td>' +
                    '<td>' + createdStr + '</td>' +
                    '<td>' +
                        '<button class="action-btn" onclick="updateBookingStatus(' + booking.id + ', \'confirmed\')">‚úÖ</button>' +
                        '<button class="action-btn" onclick="updateBookingStatus(' + booking.id + ', \'cancelled\')">‚ùå</button>' +
                        '<button class="action-btn delete" onclick="deleteBooking(' + booking.id + ')">üóëÔ∏è</button>' +
                    '</td>' +
                '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('bookingsTable').innerHTML = html;
        }

        async function updateBookingStatus(bookingId, status) {
            if (!confirm('–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #' + bookingId + ' –Ω–∞ "' + status + '"?')) return;
            try {
                const { error } = await supabase.from('bookings').update({ status: status }).eq('id', bookingId);
                if (error) throw error;
                showStatus('–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è #' + bookingId + ' –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ "' + status + '"');
                loadBookingsTable(currentBookingsPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error); showStatus('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', true);}
        }

        async function deleteBooking(bookingId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #' + bookingId + '?')) return;
            try {
                const { error } = await supabase.from('bookings').delete().eq('id', bookingId);
                if (error) throw error;
                showStatus('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #' + bookingId + ' —É–¥–∞–ª–µ–Ω–æ');
                loadBookingsTable(currentBookingsPage);
            } catch (error) {console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error); showStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è', true);}
        }

        // ==================== –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò ====================
        async function loadUsersTable(page = 1, search = '') {
            try {
                document.getElementById('usersTable').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>';
                let query = supabase.from('profiles').select('*', { count: 'exact' });
                if (search) {query = query.or('email.ilike.%' + search + '%,username.ilike.%' + search + '%');}
                const { data: profiles, error, count } = await query.order('created_at', { ascending: false }).range((page - 1) * itemsPerPage, page * itemsPerPage - 1);
                if (error) {console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error); document.getElementById('usersTable').innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">–¢–∞–±–ª–∏—Ü–∞ profiles –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.<br>–ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –≤ Supabase SQL Editor.</div>'; return;}
                currentUsersPage = page;
                displayUsersTable(profiles || [], count || 0);
                createPagination('usersPagination', count || 0, page, 'loadUsersTable');
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error); document.getElementById('usersTable').innerHTML = '<div style="color: #ff4444;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';}
        }

        function displayUsersTable(profiles, totalCount) {
            if (!profiles || profiles.length === 0) {
                document.getElementById('usersTable').innerHTML = '<div style="color: #666; text-align: center;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ profiles</div>';
                return;
            }
            
            let html = '<table class="data-table"><thead><tr><th>ID</th><th>Username</th><th>–¢–∏–ø</th><th>–°–æ–∑–¥–∞–Ω</th><th>–û–±–Ω–æ–≤–ª–µ–Ω</th><th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ª–æ–≥–∏–Ω</th><th>–î–µ–π—Å—Ç–≤–∏—è</th></tr></thead><tbody>';
            
            profiles.forEach(profile => {
                const shortId = profile.id ? profile.id.substring(0, 8) + '...' : 'N/A';
                const username = profile.username || (profile.email ? profile.email.split('@')[0] : 'user') || 'user';
                const userType = profile.user_type || 'user';
                const userTypeColor = userType === 'admin' ? '#00ff00' : '#8fd493';
                const created = profile.created_at ? new Date(profile.created_at).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                const updated = profile.updated_at ? new Date(profile.updated_at).toLocaleString('ru-RU') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
                const emailForAttr = (profile.email || username).replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const lastLogin = profile.last_login_at || profile.last_sign_in_at || 'Never';
                const usernameForAttr = username.replace(/'/g, "\\'").replace(/"/g, '&quot;');
                const lastLoginFormatted  = lastLogin !== 'Never' ? new Date(lastLogin).toLocaleString('ru-RU'): '–ù–∏–∫–æ–≥–¥–∞';
                
                html += '<tr>' +
                    '<td title="' + (profile.id || '') + '">' + shortId + '</td>' +
                    '<td>' + username + '</td>' +
                    '<td style="color: ' + userTypeColor + '">' + userType + '</td>' +
                    '<td>' + created + '</td>' +
                    '<td>' + updated + '</td>' +
                    '<td>' + lastLoginFormatted + '</td>' +
                    '<td>' +
                        '<button class="action-btn" onclick="makeAdmin(\'' + profile.id + '\', \'' + emailForAttr + '\')">üëë</button>' +
                        '<button class="action-btn" onclick="makeUser(\'' + profile.id + '\', \'' + emailForAttr + '\')">üë§</button>' +
                        '<button class="action-btn warning" onclick="sendPasswordReset(\'' + profile.id + '\', \'' + emailForAttr + '\')">üîê</button>' +
                        '<button class="action-btn" onclick="changeUsername(\'' + profile.id + '\', \'' + emailForAttr + '\')">üìù</button>' +
                        '<button class="action-btn delete" onclick="deleteProfile(\'' + profile.id + '\', \'' + emailForAttr + '\')">üóëÔ∏è</button>' +
                    '</td>' +
                '</tr>';
            });
            
            html += '</tbody></table>';
            document.getElementById('usersTable').innerHTML = html;
        }

        function searchBookings() {const search = document.getElementById('searchBookings').value; loadBookingsTable(1, search);}
        function searchUsers() {const search = document.getElementById('searchUsers').value; loadUsersTable(1, search);}

        function createPagination(elementId, totalCount, currentPage, callbackFunction) {
            const totalPages = Math.ceil(totalCount / itemsPerPage);
            if (totalPages <= 1) {document.getElementById(elementId).innerHTML = ''; return;}
            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {html += '<button class="' + (i === currentPage ? 'active' : '') + '" onclick="' + callbackFunction + '(' + i + ')">' + i + '</button>';}
                else if (i === currentPage - 3 || i === currentPage + 3) {html += '<span>...</span>';}
            }
            document.getElementById(elementId).innerHTML = html;
        }

        // ==================== –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function showStatus(message, isError = false) {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.style.background = isError ? 'rgba(255, 0, 0, 0.9)' : 'rgba(0, 255, 0, 0.9)';
            statusMessage.style.display = 'block';
            setTimeout(() => {statusMessage.style.display = 'none';}, 3000);
        }

        function playSound(soundPath) {
            const audio = new Audio(soundPath);
            audio.onerror = function() {document.body.classList.add('error-bg'); setTimeout(() => {document.body.classList.remove('error-bg');}, 1000);};
            audio.oncanplaythrough = function() {showStatus('–†–∞–±–æ—Ç–∞–µ—Ç!'); audio.play();};
            audio.load();
        }

        function checkPage(pagePath) {
            fetch(pagePath, { method: 'HEAD' }).then(response => {if (response.ok) {showStatus('–†–∞–±–æ—Ç–∞–µ—Ç!');} else {throw new Error('File not found');}}).catch(error => {document.body.classList.add('error-bg'); setTimeout(() => {document.body.classList.remove('error-bg');}, 1000);});
        }

        function checkBackground(bgPath) {
            const img = new Image();
            img.onload = function() {showStatus('–†–∞–±–æ—Ç–∞–µ—Ç!');};
            img.onerror = function() {document.body.classList.add('error-bg'); setTimeout(() => {document.body.classList.remove('error-bg');}, 1000);};
            img.src = bgPath;
        }

        function playTrack(track, name) {
            if (audio) {audio.pause();}
            audio = new Audio(track);
            audio.onerror = function() {document.body.classList.add('error-bg'); setTimeout(() => {document.body.classList.remove('error-bg');}, 1000);};
            audio.oncanplaythrough = function() {showStatus('–†–∞–±–æ—Ç–∞–µ—Ç!'); audio.play(); document.getElementById('nowPlaying').textContent = '–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç: ' + name;};
            audio.load(); currentTrack = { track, name };
        }

        function playMusic() {if (audio && currentTrack) {audio.play(); document.getElementById('nowPlaying').textContent = '–°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç: ' + currentTrack.name;}}
        function pauseMusic() {if (audio) {audio.pause(); document.getElementById('nowPlaying').textContent = '–ü–∞—É–∑–∞';}}
        function stopMusic() {if (audio) {audio.pause(); audio.currentTime = 0; document.getElementById('nowPlaying').textContent = '';}}

        async function logoutSupabase() {
            try {if (supabase && currentUser) {await supabase.auth.signOut();}
                localStorage.removeItem('supabase.auth.token'); localStorage.removeItem('sb-gdbemyluqtnfytvujfnu-auth-token'); window.location.reload();
            } catch (error) {console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error); window.location.reload();}
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('adminLoginSection').style.display === 'block') {checkLogin();}
            if (e.key === 'Enter' && document.getElementById('inviteEmail') && document.getElementById('inviteEmail').value) {inviteUser();}
        });
    </script>
</body>
</html>